# **User Study: Validating Hierarchical Representations in Long Documents**

## **PART 1: STUDY DESIGN OVERVIEW**

### **1.1 Research Questions**

#### **A. Primary Research Questions**
```python
class ResearchQuestions:
    """
    Define research questions for user study
    """
    
    def __init__(self):
        self.questions = self.define_research_questions()
    
    def define_research_questions(self):
        """
        Primary and secondary research questions
        """
        questions = {
            # Primary RQs
            'RQ1': {
                'question': 'Do hierarchical representations learned by the model align with human-perceived document structure?',
                'hypothesis': 'H1: Model-learned hierarchical boundaries correlate significantly (r > 0.6) with human annotations',
                'null_hypothesis': 'H0: No significant correlation between model and human hierarchies',
                'measurement': 'Boundary agreement, hierarchical similarity metrics',
            },
            
            'RQ2': {
                'question': 'Do model attention patterns match human attention allocation when reading long documents?',
                'hypothesis': 'H2: Model attention weights correlate with human-reported importance ratings (r > 0.5)',
                'null_hypothesis': 'H0: No significant correlation between model attention and human importance',
                'measurement': 'Attention-importance correlation, eye-tracking data',
            },
            
            'RQ3': {
                'question': 'Does hierarchical structure improve human understanding compared to flat representations?',
                'hypothesis': 'H3: Humans perform better on comprehension tasks with hierarchical vs. flat document views',
                'null_hypothesis': 'H0: No significant difference in comprehension',
                'measurement': 'Comprehension accuracy, task completion time',
            },
            
            # Secondary RQs
            'RQ4': {
                'question': 'How do model-learned hierarchies compare across different document types?',
                'hypothesis': 'H4: Agreement varies by document type (higher for structured documents)',
                'measurement': 'Stratified analysis by document type',
            },
            
            'RQ5': {
                'question': 'What factors influence human-model alignment?',
                'hypothesis': 'H5: Alignment correlates with document length, structural clarity, domain expertise',
                'measurement': 'Regression analysis with moderating variables',
            },
            
            'RQ6': {
                'question': 'Can humans distinguish between model-generated and human-generated hierarchies?',
                'hypothesis': 'H6: Humans cannot distinguish at above-chance levels',
                'measurement': 'Discrimination accuracy, confidence ratings',
            },
        }
        
        return questions
```

---

### **1.2 Study Design Framework**

#### **A. Mixed-Methods Approach**
```python
class StudyDesignFramework:
    """
    Comprehensive study design combining multiple methods
    """
    
    def __init__(self):
        self.design = self.define_study_design()
    
    def define_study_design(self):
        """
        Multi-phase mixed-methods design
        """
        design = {
            # Phase 1: Annotation Study
            'phase_1_annotation': {
                'goal': 'Collect human annotations of document structure',
                'method': 'Hierarchical annotation task',
                'participants': 'N=50 (main study) + N=10 (pilot)',
                'duration': '60-90 minutes per participant',
                'output': 'Human-annotated hierarchical structures',
                'timeline': 'Weeks 1-4',
            },
            
            # Phase 2: Attention Study
            'phase_2_attention': {
                'goal': 'Measure human attention patterns',
                'method': 'Eye-tracking + importance ratings',
                'participants': 'N=30 (subset from Phase 1)',
                'duration': '45-60 minutes per participant',
                'output': 'Attention heatmaps, importance scores',
                'timeline': 'Weeks 5-7',
            },
            
            # Phase 3: Comprehension Study
            'phase_3_comprehension': {
                'goal': 'Test comprehension with different representations',
                'method': 'Between-subjects controlled experiment',
                'participants': 'N=120 (40 per condition)',
                'duration': '30-45 minutes per participant',
                'output': 'Comprehension scores, task times',
                'timeline': 'Weeks 8-11',
            },
            
            # Phase 4: Discrimination Study
            'phase_4_discrimination': {
                'goal': 'Test if humans can distinguish model vs. human hierarchies',
                'method': 'Two-alternative forced choice',
                'participants': 'N=40',
                'duration': '20-30 minutes per participant',
                'output': 'Discrimination accuracy, confidence',
                'timeline': 'Weeks 12-13',
            },
            
            # Phase 5: Qualitative Study
            'phase_5_qualitative': {
                'goal': 'Understand reasoning behind structure judgments',
                'method': 'Think-aloud protocol + semi-structured interviews',
                'participants': 'N=15 (purposive sampling)',
                'duration': '60 minutes per participant',
                'output': 'Qualitative themes, reasoning patterns',
                'timeline': 'Weeks 14-16',
            },
        }
        
        return design
```

---

## **PART 2: SAMPLE SIZE DETERMINATION**

### **2.1 Power Analysis**

#### **A. Statistical Power Calculations**
```python
class PowerAnalysis:
    """
    Determine required sample sizes for each phase
    """
    
    def __init__(self):
        self.power_analyses = self.conduct_power_analyses()
    
    def conduct_power_analyses(self):
        """
        Power analysis for each research question
        """
        from statsmodels.stats.power import tt_ind_solve_power, zt_ind_solve_power
        import numpy as np
        
        analyses = {
            # RQ1: Correlation between model and human hierarchies
            'rq1_correlation': {
                'test': 'Pearson correlation',
                'effect_size': 'r = 0.6 (large effect)',
                'alpha': 0.05,
                'power': 0.80,
                'calculation': self.sample_size_correlation(r=0.6, alpha=0.05, power=0.80),
                'required_n': 19,  # documents
                'proposed_n': 50,  # for robustness + stratification
                'rationale': 'Need sufficient documents across types',
            },
            
            # RQ2: Attention-importance correlation
            'rq2_attention': {
                'test': 'Correlation (attention vs. importance)',
                'effect_size': 'r = 0.5 (medium-large)',
                'alpha': 0.05,
                'power': 0.80,
                'calculation': self.sample_size_correlation(r=0.5, alpha=0.05, power=0.80),
                'required_n': 29,  # participants
                'proposed_n': 30,
                'rationale': 'Eye-tracking is expensive, minimum viable',
            },
            
            # RQ3: Comprehension comparison (between-subjects)
            'rq3_comprehension': {
                'test': 'Independent samples t-test',
                'effect_size': "Cohen's d = 0.5 (medium)",
                'alpha': 0.05,
                'power': 0.80,
                'calculation': tt_ind_solve_power(
                    effect_size=0.5,
                    alpha=0.05,
                    power=0.80,
                    alternative='two-sided'
                ),
                'required_n_per_group': 64,
                'proposed_n_per_group': 40,  # 3 groups = 120 total
                'note': 'Slightly underpowered but practical',
                'rationale': 'Budget constraints, still reasonable power (~0.70)',
            },
            
            # RQ6: Discrimination accuracy
            'rq6_discrimination': {
                'test': 'One-sample t-test (vs. chance = 0.5)',
                'effect_size': "Cohen's d = 0.5",
                'alpha': 0.05,
                'power': 0.80,
                'calculation': tt_ind_solve_power(
                    effect_size=0.5,
                    alpha=0.05,
                    power=0.80,
                    alternative='two-sided'
                ) / 2,  # One-sample requires fewer
                'required_n': 34,
                'proposed_n': 40,
                'rationale': 'Adequate power for discrimination task',
            },
        }
        
        return analyses
    
    def sample_size_correlation(self, r, alpha, power):
        """
        Calculate sample size for correlation test
        
        Formula: n ≈ (Z_α/2 + Z_β)² / (0.5 * ln((1+r)/(1-r)))²
        """
        from scipy.stats import norm
        
        z_alpha = norm.ppf(1 - alpha/2)
        z_beta = norm.ppf(power)
        
        # Fisher's Z transformation
        fisher_z = 0.5 * np.log((1 + r) / (1 - r))
        
        n = ((z_alpha + z_beta) / fisher_z) ** 2 + 3
        
        return int(np.ceil(n))
    
    def calculate_total_sample_size(self):
        """
        Calculate total unique participants needed
        """
        total = {
            'phase_1_annotation': 50,  # Main annotation study
            'phase_2_attention': 30,   # Subset from Phase 1
            'phase_3_comprehension': 120,  # New participants (between-subjects)
            'phase_4_discrimination': 40,  # New participants
            'phase_5_qualitative': 15,  # Subset from previous phases
            
            'total_unique_participants': 50 + 120 + 40,  # 210 unique
            'total_with_overlap': 210,  # Assuming no overlap for conservative estimate
            
            'budget_estimate': {
                'participant_compensation': '$15-20 per hour',
                'total_hours': '210 participants × 1.5 hours avg = 315 hours',
                'compensation_cost': '$4,725 - $6,300',
                'platform_fees': '$500 (Prolific/MTurk)',
                'total_budget': '$5,225 - $6,800',
            },
        }
        
        return total
```

---

### **2.2 Participant Recruitment**

#### **A. Recruitment Strategy**
```python
class ParticipantRecruitment:
    """
    Recruitment strategy and eligibility criteria
    """
    
    def __init__(self):
        self.strategy = self.define_recruitment_strategy()
    
    def define_recruitment_strategy(self):
        """
        Comprehensive recruitment plan
        """
        strategy = {
            # Eligibility Criteria
            'eligibility': {
                'inclusion_criteria': [
                    'Age 18-65',
                    'Native or fluent English speaker',
                    'Normal or corrected-to-normal vision',
                    'At least high school education',
                    'Experience reading long documents (self-reported)',
                ],
                'exclusion_criteria': [
                    'Prior exposure to study materials',
                    'Cognitive impairments affecting reading',
                    'Visual impairments incompatible with tasks',
                ],
                'special_requirements_phase_2': [
                    'No glasses (for eye-tracking)',
                    'Or contact lenses acceptable',
                ],
            },
            
            # Recruitment Channels
            'recruitment_channels': {
                'online_platforms': {
                    'prolific': {
                        'target': 'General population sample',
                        'n': 150,
                        'screening': 'Pre-screening questionnaire',
                        'compensation': '$15/hour',
                    },
                    'mturk': {
                        'target': 'Backup recruitment',
                        'n': 50,
                        'requirements': 'Master qualification, 95%+ approval',
                        'compensation': '$15/hour',
                    },
                },
                'university_recruitment': {
                    'target': 'Students and staff',
                    'n': 30,
                    'method': 'Campus flyers, email lists',
                    'compensation': '$20/hour or course credit',
                },
                'professional_networks': {
                    'target': 'Domain experts (for stratification)',
                    'n': 30,
                    'method': 'Professional organizations, LinkedIn',
                    'compensation': '$25/hour (higher expertise)',
                },
            },
            
            # Stratification
            'stratification_goals': {
                'education_level': {
                    'high_school': '25%',
                    'bachelors': '50%',
                    'graduate': '25%',
                },
                'reading_expertise': {
                    'casual_readers': '40%',
                    'frequent_readers': '40%',
                    'professional_readers': '20%',
                },
                'domain_expertise': {
                    'no_expertise': '60%',
                    'some_expertise': '30%',
                    'expert': '10%',
                },
            },
            
            # Retention Strategy
            'retention': {
                'pilot_participants': 'Invite to main study',
                'multi_phase_bonus': '+$5 for completing multiple phases',
                'quality_bonus': '+$10 for high-quality annotations',
                'follow_up': 'Email reminders for multi-phase participants',
            },
        }
        
        return strategy
```

---

## **PART 3: STUDY INSTRUMENTS**

### **3.1 Phase 1: Hierarchical Annotation Task**

#### **A. Annotation Interface**
```python
class HierarchicalAnnotationInstrument:
    """
    Design annotation interface for hierarchical structure
    """
    
    def __init__(self):
        self.interface = self.design_annotation_interface()
        self.training = self.design_training_protocol()
    
    def design_annotation_interface(self):
        """
        Interactive web-based annotation interface
        """
        interface = {
            # Interface Components
            'document_display': {
                'format': 'Scrollable text pane',
                'features': [
                    'Line numbers',
                    'Paragraph indicators',
                    'Search functionality',
                    'Zoom controls',
                ],
                'styling': 'Clean, readable font (14-16pt)',
            },
            
            'annotation_tools': {
                'boundary_marking': {
                    'method': 'Click to mark section boundaries',
                    'visual': 'Colored horizontal lines',
                    'levels': [
                        'Level 1: Major sections (red)',
                        'Level 2: Subsections (blue)',
                        'Level 3: Paragraphs (green)',
                    ],
                },
                'hierarchy_tree': {
                    'display': 'Interactive tree view (sidebar)',
                    'interactions': [
                        'Drag-and-drop to reorganize',
                        'Click to navigate to section',
                        'Expand/collapse nodes',
                    ],
                },
                'labeling': {
                    'required': 'Label each section with topic/theme',
                    'method': 'Free text + optional predefined categories',
                    'examples': '"Introduction", "Methods", "Results", etc.',
                },
            },
            
            # Task Instructions
            'instructions': {
                'overview': '''
                    Your task is to identify the hierarchical structure of this document.
                    
                    Think about:
                    1. How would you divide this document into major sections?
                    2. Within each section, are there subsections?
                    3. What is the natural flow and organization?
                ''',
                'guidelines': [
                    'Mark boundaries where topic or focus shifts',
                    'Create